document.addEventListener('DOMContentLoaded', function() {
            const novaMicroarea = document.querySelector('#novaMicroarea');
            const overlay = document.querySelector('#overlay');
            const modal = document.querySelector('#modal');
            const microareaContainer = document.getElementById('microarea-container');
            const nomeMicroareaInput = document.querySelector('#nomeMicroarea');
            const botaoFechar = document.querySelector('#fechar');

            const modalExibido = localStorage.getItem('modalExibido');
            if (modalExibido === 'true') {
                overlay.style.display = 'block';
                modal.style.display = 'block';
            }

            novaMicroarea.addEventListener('click', function() {
                overlay.style.display = 'block';
                modal.style.display = 'block';
                localStorage.setItem('modalExibido', 'true');
            });

            botaoFechar.addEventListener('click', function() {
                fecharJanela(overlay, modal, nomeMicroareaInput);
            });

            document.querySelector('#criarMicroarea').addEventListener('click', function() {
                const nomeMicroarea = nomeMicroareaInput.value;

                if (verificarMicroarea(nomeMicroarea)) {
                    alert("Área Existente!");
                    return;
                } else if (nomeMicroarea === "" ) {
                    alert("Preencha todas as informações!");
                    return;
                }

                const id = uuidv4(); // Gera um UUID
                const novaMicroarea = criarMicroarea(nomeMicroarea, id);
                microareaContainer.appendChild(novaMicroarea);

                salvarMicroareaNoLocalStorage(id, nomeMicroarea);

                fecharJanela(overlay, modal, nomeMicroareaInput);
            });

            botaoFechar.addEventListener('click', function() {
                fecharJanela(overlay, modal, nomeMicroareaInput);
            });

            function criarMicroarea(endereco, id) {
                const novaMicroarea = document.createElement('div');
                novaMicroarea.className = 'area';
                novaMicroarea.innerHTML = '<h2><span class="microarea-endereco" data-id="' + id + '">' + endereco + '</p>';
            
                const editar = document.createElement('button');
                editar.innerHTML = '<i class="fa-solid fa-pen-to-square"></i>';
                editar.className = 'editar';
                editar.addEventListener('click', function() {   
                    editarMicroarea(novaMicroarea, id);
                });
                novaMicroarea.appendChild(editar);
            
                const apagar = document.createElement('button');
                apagar.innerHTML = '<i class="fa-solid fa-trash-can"></i>';
                apagar.className = 'apagar';
                apagar.addEventListener('click', function() { 
                    novaMicroarea.remove();
                });
                novaMicroarea.appendChild(apagar);
            
                const detalhes = document.createElement('button');
                detalhes.innerHTML = '<i class="fas fa-info-circle"></i>';
                detalhes.className = 'detalhes';
                detalhes.addEventListener('click', function() {
                    window.location.href = "/detalhesMicroarea?id=" + id;
                });
                novaMicroarea.appendChild(detalhes);
            
                return novaMicroarea;
            }

            function salvarMicroareaNoLocalStorage(id, nome) {
                const microarea = {
                    id: id,
                    nome: nome,
                };
                let microareas = JSON.parse(localStorage.getItem('microareas')) || [];
                microareas.push(microarea);
                localStorage.setItem('microareas', JSON.stringify(microareas));
            }

            function fecharJanela(overlay, modal, nomeMicroareaInput) {
                nomeMicroareaInput.value = "";
                overlay.style.display = 'none';
                modal.style.display = 'none';
                localStorage.setItem('modalExibido', 'false');
            }

            function verificarMicroarea(nomeMicroarea) {
                var microareas = document.querySelectorAll('.area');

                for (var i = 0; i < microareas.length; i++) {
                    var area = microareas[i];
                    var nome = area.querySelector('.microarea-endereco').innerText.trim();

                    if (nome === nomeMicroarea.trim()) {
                        return true;
                    }
                }
                return false;
            }

            function editarMicroarea(area, id) {
                const editar = area.querySelector('.editar');
                editar.remove();

                const span = area.querySelector('.microarea-endereco');
                const p = area.querySelector('p');

                const inputNome = document.createElement('input');
                inputNome.type = 'text';
                inputNome.value = span.textContent;


                span.classList.add('editaM');
                p.classList.add('editaM');
                
                span.innerHTML = '';
                span.appendChild(inputNome);

                
                const salvar = document.createElement('button');
                salvar.innerHTML = '<i class="fa-solid fa-floppy-disk"></i>';
                salvar.className = 'salvar';
                salvar.classList.add('editarMicroarea');
                salvar.addEventListener('click', function() {
                    const novoNome = inputNome.value.trim();
                    

                    if (novoNome === '' ) {
                        alert('Por favor, preencha todos os campos.');
                        return;
                    }

                    if (novoNome !== span.textContent ) {
                        if (verificarMicroarea(novoNome)) {
                            alert('Já existe um grupo com esse nome e quantidade de pessoas.');
                            return;
                        }

                        span.textContent = novoNome;
                        atualizarMicroareaNoLocalStorage(id, novoNome);
                    }
                    
                    inputNome.remove();
                    
                    salvar.remove();
                    area.appendChild(editar);
                });
                area.appendChild(salvar);
            }

            function atualizarMicroareaNoLocalStorage(id, nome) {
                let microareas = JSON.parse(localStorage.getItem('microareas')) || [];
                for (let i = 0; i < microareas.length; i++) {
                    if (microareas[i].id === id) {
                        microareas[i].nome = nome;
                        break;
                    }
                }
                localStorage.setItem('microareas', JSON.stringify(microareas));
            }
        });